#!/usr/bin/env bash
set -eou pipefail

src_dir="usr/local/src"
deploy_dir="usr/local/deploy/bin"
cmd="${src_dir}/iris"

# Prereqs
case $(uname -a) in
  *arm* )
    set +e; eval "${deploy_dir}/apk"; update-ca-certificates; apk fix || echo 'Unable to reach apk...'; set -e; ;; # set +e when apk not available
esac

case $(cat /etc/os-release | grep -i '^name=' | sed 's/NAME=//' | sed 's/^"\(.*\)"$/\1/') in
  'Alpine Linux' )
    update-ca-certificates; apk fix || echo 'Unable to reach apk...' ;; # Any quirks with Alpine can go here
  'Debian GNU/Linux' )
    echo '' ;; # Any quirks with Debian can go here
esac
set -e

exec $cmd $@
