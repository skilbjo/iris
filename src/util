#!/usr/bin/env bash

ping_healthchecks(){
  job_uuid="$1"

  curl -fsS --retry 3 "https://hc-ping.com/${job_uuid}"
}

add_aws_vars(){
  if [[ $(whoami) == 'root' ]]; then
    local home_dir='/root'
  elif [[ $(whoami) == 'sbx_'* ]]; then
    local home_dir="/home/$(whoami)"
  elif [[ $(whoami) == 'skilbjo' ]]; then
    echo 'Easy, big guy...' && exit 1
  fi

  mkdir -p "${home_dir}/.aws"

  touch "${home_dir}/.aws/config"
  echo "[default]"           >"${home_dir}/.aws/config"
  echo "region = us-east-1" >>"${home_dir}/.aws/config"

  touch "${home_dir}/.aws/credentials"
  echo "[default]"                                       >"${home_dir}/.aws/credentials"
  echo "aws_access_key_id     = $aws_access_key_id"     >>"${home_dir}/.aws/credentials"
  echo "aws_secret_access_key = $aws_secret_access_key" >>"${home_dir}/.aws/credentials"

  export AWS_ACCESS_KEY_ID="$aws_access_key_id"
  export AWS_SECRET_ACCESS_KEY="$aws_secret_access_key"
}

csv_to_html(){
  local report="$1"

  echo '<table border="2" cellspacing="1" cellpadding="2">'         >"${tmp_dir}/${report}"
  local header='true'
  cat "${tmp_dir}/${report}.csv" | while read line; do
    if [[ $header == 'true' ]]; then
      echo "<tr><th align='center'>${line//,/</th><th>}</th></tr>" >>"${tmp_dir}/${report}";
      header='false';
    else
      echo "<tr><td align='center'>${line//,/</td><td>}</td></tr>" >>"${tmp_dir}/${report}";
    fi
  done
  echo '</table>'                                                  >>"${tmp_dir}/${report}"

  cat "${tmp_dir}/${report}"
}
